var bodyWidth=document.body.clientWidth,bodyHeight=document.body.clientHeight,fps=60,frameTime=1e3/fps,getRandomInt=function(e,t){return Math.floor(Math.random()*(t-e))+e},getDegree=function(e){return e/Math.PI*180},getRadian=function(e){return e*Math.PI/180},debounce=function(e,t,i){var n;e.addEventListener(t,function(e){clearTimeout(n),n=setTimeout(function(){i(e)},500)},!1)},lastTimeRender,renderer,scene,canvas,camera,raycaster=new THREE.Raycaster,mouseVector=new THREE.Vector2,intersects,pointLight,hemiLight,lightSphere,background,boxObjArr=[],boxNum=150,judgeRaycastSphere=!1,accelerating=!1,threeStart=function(){initThree(),initCamera(),initLight(),initBackground();for(var e=0;boxNum>e;e++)boxObjArr[e]=new boxObj,boxObjArr[e].init(e);setEvent(),renderloop()},initThree=function(){canvas=document.getElementById("canvas"),renderer=new THREE.WebGLRenderer({antialias:!0}),renderer||alert("Three.jsの初期化に失敗しました。"),renderer.setSize(bodyWidth,bodyHeight),canvas.appendChild(renderer.domElement),renderer.setClearColor(0,1),scene=new THREE.Scene},initCamera=function(){camera=new THREE.PerspectiveCamera(45,bodyWidth/bodyHeight,1,4e3),camera.position.set(500,500,500),camera.up.set(0,1,0),camera.lookAt({x:0,y:0,z:0})},initLight=function(){pointLight=new THREE.PointLight(16777215,1),pointLight.position.set(0,0,0),hemiLight=new THREE.HemisphereLight(16777011,16724787,0),scene.add(pointLight),scene.add(hemiLight),lightSphere=new LightSphereObj,lightSphere.init()},initBackground=function(){bgGeometry=new THREE.SphereGeometry(1e3,60,60),bgMaterial=new THREE.MeshLambertMaterial({color:8026746,side:THREE.BackSide,transparent:!0,opacity:0}),background=new THREE.Mesh(bgGeometry,bgMaterial),scene.add(background)},LightSphereObj=function(){this.id=0,this.r=80,this.x=0,this.y=0,this.z=0,this.cd=.4,this.k=.02,this.val=0,this.valBase=this.val,this.a=0,this.v=0,this.segments=30,this.geometry,this.material,this.mesh};LightSphereObj.prototype.init=function(){this.geometry=new THREE.SphereGeometry(this.r,this.segments,this.segments),this.material=new THREE.MeshLambertMaterial({color:16777215,emissive:16777215,opacity:.9,transparent:!0}),this.mesh=new THREE.Mesh(this.geometry,this.material),this.setPosition(),scene.add(this.mesh),this.id=this.mesh.id},LightSphereObj.prototype.setPosition=function(){this.mesh.position.set(this.x,this.y,this.z)},LightSphereObj.prototype.changeScale=function(){this.mesh.scale.set(1-this.val/500,1-this.val/500,1-this.val/500)},LightSphereObj.prototype.mathHook=function(){this.a=(this.valBase-this.val)*this.k,this.a-=this.cd*this.v,this.v+=this.a,this.val+=this.v};var boxObj=function(){this.size=1,this.scale=0,this.rad=0,this.rad2=0,this.r=250,this.x=0,this.y=0,this.z=0,this.rotateX=0,this.rotateY=0,this.rotateZ=0,this.mesh},boxObjGeometry=new THREE.BoxGeometry(1,1,1),boxObjMaterial=new THREE.MeshLambertMaterial({color:16777215});boxObj.prototype.init=function(){this.scale=getRandomInt(8,36),this.mesh=new THREE.Mesh(boxObjGeometry,boxObjMaterial),this.rad=getRandomInt(0,360),this.rad2=getRandomInt(0,360),this.radAccel=getRadian(getRandomInt(6,10)),this.changeScale(),this.changePositionVal(),this.setPosition(),this.changeRotationVal(),this.setRotation(),scene.add(this.mesh)},boxObj.prototype.changeScale=function(){this.mesh.scale.x=this.scale*this.size,this.mesh.scale.y=this.scale*this.size,this.mesh.scale.z=this.scale*this.size},boxObj.prototype.changePositionVal=function(){this.x=Math.cos(this.rad)*Math.cos(this.rad2)*(this.r-1.6*lightSphere.val),this.y=Math.cos(this.rad)*Math.sin(this.rad2)*(this.r-1.6*lightSphere.val),this.z=Math.sin(this.rad)*(this.r-1.6*lightSphere.val)},boxObj.prototype.setPosition=function(){this.mesh.position.set(this.x,this.y,this.z)},boxObj.prototype.changeRotationVal=function(){this.rotateX=2*this.rad,this.rotateY=2*this.rad,this.rotateZ=2*this.rad},boxObj.prototype.setRotation=function(){this.mesh.rotation.set(this.rotateX,this.rotateY,this.rotateZ)};var setEvent=function(){var e=function(e,t){mouseVector.x=e/window.innerWidth*2-1,mouseVector.y=2*-(t/window.innerHeight)+1,judgeRaycastSphere=!0},t=function(e,t){mousemoveX=e,mousemoveY=t,mouseVector.x=e/window.innerWidth*2-1,mouseVector.y=2*-(t/window.innerHeight)+1,judgeRaycastSphere=!1},i=function(){mouseVector.x=-2,mouseVector.y=-2,judgeRaycastSphere=!1,accelerating=!1,lightSphere.valBase=0};window.addEventListener("contextmenu",function(e){e.preventDefault()}),window.addEventListener("selectstart",function(e){e.preventDefault()}),window.addEventListener("mousedown",function(t){t.preventDefault(),e(t.clientX,t.clientY)}),window.addEventListener("mousemove",function(e){e.preventDefault(),t(e.clientX,e.clientY)}),window.addEventListener("mouseup",function(e){e.preventDefault(),i()}),window.addEventListener("touchstart",function(t){t.preventDefault(),e(t.touches[0].clientX,t.touches[0].clientY)}),window.addEventListener("touchmove",function(e){e.preventDefault(),t(e.touches[0].clientX,e.touches[0].clientY)}),window.addEventListener("touchend",function(e){e.preventDefault(),i()})},render=function(){var e=!1;renderer.clear(),raycaster.setFromCamera(mouseVector,camera),intersects=raycaster.intersectObjects(scene.children);for(var t=0;t<intersects.length;t++)intersects[t].object.id==lightSphere.id&&(e=!0,document.body.className="is-focus-sphere",judgeRaycastSphere&&(accelerating=!0,lightSphere.valBase=100));e||(document.body.className=""),lightSphere.mathHook(),lightSphere.changeScale(),hemiLight.intensity=lightSphere.val/105,background.material.opacity=lightSphere.val/100;for(var t=0;t<boxObjArr.length;t++)boxObjArr[t].rad+=getRadian(.12)+boxObjArr[t].radAccel*(lightSphere.val/100),boxObjArr[t].rad2+=getRadian(.12)+boxObjArr[t].radAccel*(lightSphere.val/100),boxObjArr[t].changePositionVal(),boxObjArr[t].setPosition(),boxObjArr[t].changeRotationVal(),boxObjArr[t].setRotation();renderer.render(scene,camera)},renderloop=function(){var e=+new Date;requestAnimationFrame(renderloop),frameTime>e-lastTimeRender||(render(),lastTimeRender=+new Date)},resizeRenderer=function(){bodyWidth=document.body.clientWidth,bodyHeight=document.body.clientHeight,renderer.setSize(bodyWidth,bodyHeight),initCamera()};debounce(window,"resize",function(){resizeRenderer()}),threeStart();