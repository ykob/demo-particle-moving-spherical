var bodyWidth=document.body.clientWidth,bodyHeight=document.body.clientHeight,fps=60,frameTime=1e3/fps,getRandomInt=function(e,t){return Math.floor(Math.random()*(t-e))+e},getDegree=function(e){return e/Math.PI*180},getRadian=function(e){return e*Math.PI/180},debounce=function(e,t,i){var n;e.addEventListener(t,function(e){clearTimeout(n),n=setTimeout(function(){i(e)},500)},!1)},lastTimeRender,renderer,scene,canvas,camera,raycaster=new THREE.Raycaster,mouseVector=new THREE.Vector2,intersects,pointLight,ambientLight,lightSphere,boxObjArr=[],boxNum=200,judgeRaycastSphere=!1,accelerating=!1,threeStart=function(){initThree(),initCamera(),initLight();for(var e=0;boxNum>e;e++)boxObjArr[e]=new boxObj,boxObjArr[e].init(e);setEvent(),renderloop()},initThree=function(){canvas=document.getElementById("canvas"),renderer=new THREE.WebGLRenderer({antialias:!0}),renderer||alert("Three.jsの初期化に失敗しました。"),renderer.setSize(bodyWidth,bodyHeight),canvas.appendChild(renderer.domElement),renderer.setClearColor(0,1),scene=new THREE.Scene},initCamera=function(){camera=new THREE.PerspectiveCamera(45,bodyWidth/bodyHeight,1,4e3),camera.position.set(500,500,500),camera.up.set(0,1,0),camera.lookAt({x:0,y:0,z:0})},initLight=function(){pointLight=new THREE.PointLight(16777215,1),pointLight.position.set(0,0,0),pointLightHelper=new THREE.PointLightHelper(pointLight,1),ambientLight=new THREE.AmbientLight(1118481),scene.add(pointLight),scene.add(ambientLight),lightSphere=new LightSphereObj,lightSphere.init()},LightSphereObj=function(){this.id=0,this.r=80,this.x=0,this.y=0,this.z=0,this.cd=.4,this.k=.03,this.val=0,this.valBase=this.val,this.a=0,this.v=0,this.segments=30,this.geometry,this.material,this.mesh};LightSphereObj.prototype.init=function(){this.geometry=new THREE.SphereGeometry(this.r,this.segments,this.segments),this.material=new THREE.MeshLambertMaterial({color:16777215,emissive:16777215,opacity:.9,transparent:!0}),this.mesh=new THREE.Mesh(this.geometry,this.material),this.setPosition(),scene.add(this.mesh),this.id=this.mesh.id},LightSphereObj.prototype.setPosition=function(){this.mesh.position.set(this.x,this.y,this.z)},LightSphereObj.prototype.mathHook=function(){this.a=(this.valBase-this.val)*this.k,this.a-=this.cd*this.v,this.v+=this.a,this.val+=this.v};var boxObj=function(){this.size=1,this.scale=0,this.rad=0,this.rad2=0,this.r=240,this.x=0,this.y=0,this.z=0,this.rotateX=0,this.rotateY=0,this.rotateZ=0,this.mesh},boxObjGeometry=new THREE.BoxGeometry(1,1,1),boxObjMaterial=new THREE.MeshLambertMaterial({color:16777215});boxObj.prototype.init=function(){this.scale=getRandomInt(8,36),this.mesh=new THREE.Mesh(boxObjGeometry,boxObjMaterial),this.rad=getRandomInt(0,360),this.rad2=getRandomInt(0,360),this.radAccel=getRadian(getRandomInt(5,8)),this.changeScale(),this.changePositionVal(),this.setPosition(),this.changeRotationVal(),this.setRotation(),scene.add(this.mesh)},boxObj.prototype.changeScale=function(){this.mesh.scale.x=this.scale*this.size,this.mesh.scale.y=this.scale*this.size,this.mesh.scale.z=this.scale*this.size},boxObj.prototype.changePositionVal=function(){this.x=Math.cos(this.rad)*Math.cos(this.rad2)*(this.r-1.5*lightSphere.val),this.y=Math.cos(this.rad)*Math.sin(this.rad2)*(this.r-1.5*lightSphere.val),this.z=Math.sin(this.rad)*(this.r-1.5*lightSphere.val)},boxObj.prototype.setPosition=function(){this.mesh.position.set(this.x,this.y,this.z)},boxObj.prototype.changeRotationVal=function(){this.rotateX=2*this.rad,this.rotateY=2*this.rad,this.rotateZ=2*this.rad},boxObj.prototype.setRotation=function(){this.mesh.rotation.set(this.rotateX,this.rotateY,this.rotateZ)};var setEvent=function(){var e=0,t=0,i=function(i,n){e=i,t=n,mouseVector.x=i/window.innerWidth*2-1,mouseVector.y=2*-(n/window.innerHeight)+1,judgeRaycastSphere=!0},n=function(){accelerating=!1,lightSphere.valBase=0};window.addEventListener("contextmenu",function(e){e.preventDefault()}),window.addEventListener("selectstart",function(e){e.preventDefault()}),canvas.addEventListener("mousedown",function(e){e.preventDefault(),i(e.clientX,e.clientY)}),canvas.addEventListener("mouseup",function(e){e.preventDefault(),n()}),canvas.addEventListener("touchstart",function(e){e.preventDefault(),i(e.touches[0].clientX,e.touches[0].clientY)}),canvas.addEventListener("touchend",function(e){e.preventDefault(),n()})},render=function(){if(renderer.clear(),judgeRaycastSphere){raycaster.setFromCamera(mouseVector,camera),intersects=raycaster.intersectObjects(scene.children);for(var e=0;e<intersects.length;e++)intersects[e].object.id==lightSphere.id&&(accelerating=!0,lightSphere.valBase=100);judgeRaycastSphere=!1}lightSphere.mathHook();for(var e=0;e<boxObjArr.length;e++)boxObjArr[e].rad+=getRadian(.2)+boxObjArr[e].radAccel*(lightSphere.val/100),boxObjArr[e].rad2+=getRadian(.2)+boxObjArr[e].radAccel*(lightSphere.val/100),boxObjArr[e].changePositionVal(),boxObjArr[e].setPosition(),boxObjArr[e].changeRotationVal(),boxObjArr[e].setRotation();renderer.render(scene,camera)},renderloop=function(){var e=+new Date;requestAnimationFrame(renderloop),frameTime>e-lastTimeRender||(render(),lastTimeRender=+new Date)},resizeRenderer=function(){bodyWidth=document.body.clientWidth,bodyHeight=document.body.clientHeight,renderer.setSize(bodyWidth,bodyHeight),initCamera()};debounce(window,"resize",function(){resizeRenderer()}),threeStart();